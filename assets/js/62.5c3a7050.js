(window.webpackJsonp=window.webpackJsonp||[]).push([[62],{436:function(s,t,a){"use strict";a.r(t);var n=a(26),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"插件使用（目前处于测试状态）"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#插件使用（目前处于测试状态）"}},[s._v("#")]),s._v(" "),a("H2Icon"),s._v(" 插件使用（目前处于测试状态）")],1),s._v(" "),a("h2",{attrs:{id:"用配置开启插件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#用配置开启插件"}},[s._v("#")]),s._v(" 用配置开启插件")]),s._v(" "),a("p",[s._v("打开"),a("code",[s._v("app/config/setting.py")]),s._v("文件，如果该文件中已经存在了如下配置：")]),s._v(" "),a("div",{staticClass:"language-py extra-class"},[a("pre",{pre:!0,attrs:{class:"language-py"}},[a("code",[s._v("PLUGIN_PATH "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'oss'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'path'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'app.plugins.oss'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'enable'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("True")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("p",[s._v("那便证明你已经使用了最新的示例项目，不需要更新，如果你的配置文件没有上述字段，请更换成上述配置。")]),s._v(" "),a("p",[s._v("下面我们解释这个配置项：")]),s._v(" "),a("ul",[a("li",[s._v("PLUGIN_PATH：每个插件的单独配置。\n如"),a("code",[s._v("oss")]),s._v("代表当前的插件的名字为"),a("strong",[s._v("oss")]),s._v("，"),a("code",[s._v("path")]),s._v("表示插件的路径，如 oss 插件的路径在"),a("code",[s._v("app/plugins/oss")]),s._v("下，"),a("code",[s._v("enable")]),s._v("表示开启 oss 插件。")])]),s._v(" "),a("h2",{attrs:{id:"上传图片至本地"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#上传图片至本地"}},[s._v("#")]),s._v(" 上传图片至本地")]),s._v(" "),a("h3",{attrs:{id:"默认使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#默认使用"}},[s._v("#")]),s._v(" 默认使用")]),s._v(" "),a("p",[s._v("我们运行"),a("code",[s._v("starter.py")]),s._v("文件，然后请打开 postman 测试工具，选择 post 方法，请求 url 为"),a("code",[s._v("http://localhost:5000/plugin/oss/upload_to_local")]),s._v("。")]),s._v(" "),a("p",[s._v("你可能会有所疑惑？这个 url 是如何确定的，插件中的路由 url 满足下述规范。")]),s._v(" "),a("ul",[a("li",[s._v("所有插件的路由都会被挂载到 plugin 的蓝图中，该蓝图的路径前缀为"),a("code",[s._v("/plugin")]),s._v("。")]),s._v(" "),a("li",[s._v("每个单独的插件都会有一个名字，如 oss 插件的名称为"),a("code",[s._v("oss")]),s._v("，若在该插件下，存在多个红图实例（redprint）,则其所有路由都会有一个二级前缀"),a("code",[s._v("/oss")]),s._v("。若该插件下只存在一个红图实例，即一个 controller，则不会有二级前缀，你的路径只有一个一级前缀，即"),a("code",[s._v("/plugin")]),s._v("。")]),s._v(" "),a("li",[s._v("后面的路径就被每个插件下的红图所确定，如 oss 插件下有个名为"),a("code",[s._v("oss")]),s._v("红图实例，该红图下有"),a("code",[s._v("upload_to_local")]),s._v("这个视图函数。此时该插件只有一个红图实例，故它的前缀只有一级，所以上传到本地的 url 为"),a("code",[s._v("/plugin/oss/upload_to_local")]),s._v("。如果 oss 插件下有多个红图实例，且某个红图名为"),a("code",[s._v("some")]),s._v("，some 下有"),a("code",[s._v("test")]),s._v("的视图函数，则访问这个视图函数的 url 为"),a("code",[s._v("/plugin/oss/some/test")]),s._v("。")])]),s._v(" "),a("img-wrapper",[a("img",{attrs:{src:"http://imglf6.nosdn0.126.net/img/Qk5LWkJVWkF3NmdaV1VSUVRXWWR1TnJRMkV2dzF4ampld1lyWHA4L1duZmMyVFc3RWVnQ2pRPT0.png?imageView&thumbnail=1680x0&quality=96&stripmeta=0"}})]),s._v(" "),a("p",[s._v("并选择任意一张本地图片上传，你可能会有些许奇怪，本地上传本地？当然你也可以上传到阿里云，前提是你已经开通了自己的 oss，在这里我们先以上传到本地为例。")]),s._v(" "),a("p",[s._v("点击"),a("code",[s._v("Send")]),s._v("，如果一些顺利你会看到如下返回结果：")]),s._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"error_code"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"msg"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"成功"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"request"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"POST  /plugin/oss/upload_to_local"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("p",[s._v("并且你的根目录下的 app 目录下会多出一张你刚才上传的图片。")]),s._v(" "),a("h3",{attrs:{id:"修改配置后使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改配置后使用"}},[s._v("#")]),s._v(" 修改配置后使用")]),s._v(" "),a("p",[s._v("有时候，我们不希望直接把图片传到 app 目录下（oss 插件的默认配置上传目录为 app 目录），那将该如何修改了？")]),s._v(" "),a("p",[s._v("很简单，前面我们提到过多次插件的配置，记住是插件单独的配置。打开"),a("code",[s._v("app\\plugins\\oss\\config.py")]),s._v("文件：")]),s._v(" "),a("div",{staticClass:"language-py extra-class"},[a("pre",{pre:!0,attrs:{class:"language-py"}},[a("code",[s._v("access_key_id "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'not complete'")]),s._v("\naccess_key_secret "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'not complete'")]),s._v("\nendpoint "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'http://oss-cn-shenzhen.aliyuncs.com'")]),s._v("\nbucket_name "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'not complete'")]),s._v("\n\nupload_folder "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'app'")]),s._v("\nallowed_extensions "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'jpg'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'gif'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'png'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'bmp'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),a("p",[s._v("如上，便是该 oss 插件的配置，其中"),a("code",[s._v("access_key_id")]),s._v("，"),a("code",[s._v("access_key_secret")]),s._v("，"),a("code",[s._v("endpoint")]),s._v("，"),a("code",[s._v("bucket_name")]),s._v("均为阿里云 oss 的配置项，如需使用 oss 上传图片，直接修改这些配置项即可。")]),s._v(" "),a("p",[a("code",[s._v("upload_folder")]),s._v("表示上传到本地的路径，默认是工作目录下的 app 目录，"),a("code",[s._v("allowed_extensions")]),s._v("便是支持哪些格式的图片上传，如"),a("code",[s._v("jpg")]),s._v("。")]),s._v(" "),a("p",[s._v("接下来，我们修改配置使图片上传到"),a("code",[s._v("app/static")]),s._v("，请注意，如果你的 app 目录下没有 static 目录，请新建一个 static 文件夹。")]),s._v(" "),a("p",[s._v("那么我们该在上述的"),a("code",[s._v("config.py")]),s._v("文件中修改"),a("code",[s._v("upload_folder")]),s._v("吗？理论上说没问题，但是原则上不好！因为我们的插件可能来源于"),a("code",[s._v("pipy")]),s._v("，即它可能不在当前的 plugins 目录下，那么我们不可能直接去 site-packages 下修改配置，所以我们需要在另外一个地方修改配置。这个地方就是刚才的"),a("code",[s._v("PLUGIN_PATH")]),s._v("。")]),s._v(" "),a("div",{staticClass:"language-py extra-class"},[a("pre",{pre:!0,attrs:{class:"language-py"}},[a("code",[s._v("PLUGIN_PATH "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'oss'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'path'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'app.plugins.oss'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'enable'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("True")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'upload_folder'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'app/static'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("p",[s._v("再次在 postman 上点击"),a("code",[s._v("Send")]),s._v("按钮，如果顺利，此时"),a("code",[s._v("app/static")]),s._v("下已经多了一张图片。")]),s._v(" "),a("h2",{attrs:{id:"小结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#小结"}},[s._v("#")]),s._v(" 小结")]),s._v(" "),a("p",[s._v("在本小节，我们使用了 oss 这个插件，当然只能上传到本地，如果你有阿里云 oss 账号，大可配置好后，使用其他接口，请在"),a("code",[s._v("controller.py")]),s._v("文件中查看相应的 api。")]),s._v(" "),a("p",[s._v("我们还通过修改配置来修改上传的目录，请注意配置很重要，真的很重要，它给了插件很大的灵活性。")]),s._v(" "),a("p",[s._v("但是，在此你可能会疑惑，插件的配置与 Flask 的配置有何区别？为何我们还需要一个插件的配置，而不是直接从 Flask 中读取。")]),s._v(" "),a("p",[s._v("原因有如下几点:")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("Flask 的配置依赖 Flask 的上下文。在 Flask 中读取配置，你必须在 Flask 的上下文中才能读取到相应的配置，而我们的插件是通过路径加载的，它的加载先于 Flask 的上下文创建，因此很多配置只能在视图函数中使用，这不够灵活。")])]),s._v(" "),a("li",[a("p",[s._v("插件的配置既可以在 config.py 中配置，也可以在 setting.py 中更改，Flask 本身的配置机制不能够满足如此需求。")])]),s._v(" "),a("li",[a("p",[s._v("再者，Flask 的配置有明确的要求，所有字母均要求大写，但很多时候如"),a("code",[s._v("oss")]),s._v("名称，我们还是觉得小写比较直观，而且我们必须让取配置更加方便，如"),a("code",[s._v("lin_config.get_config('oss.upload_folder')")]),s._v("可直接取到 oss 下的 upload_folder 配置。很多时候插件的配置是层叠的，我们支持二级直接取配置。")])])]),s._v(" "),a("p",[s._v("插件的实战到这里就结束了，你可能觉得会有些短，有些少。但是这确实是真实的情况，因为插件本身就很简单，你完全可以把它理解为一个"),a("strong",[s._v("微 app")]),s._v("。按照我们之前的开发规范来开发插件即可。")]),s._v(" "),a("p",[s._v("想要自己写一个插件，来，"),a("RouterLink",{attrs:{to:"/server/flask/plugin_create.html"}},[s._v("我们开始")])],1),s._v(" "),a("RightMenu")],1)}),[],!1,null,null,null);t.default=e.exports}}]);