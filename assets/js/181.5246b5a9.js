(window.webpackJsonp=window.webpackJsonp||[]).push([[181],{562:function(s,t,a){"use strict";a.r(t);var e=a(26),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"项目规范"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#项目规范"}},[s._v("#")]),s._v(" 项目规范")]),s._v(" "),a("p",[s._v("本小节，我们将介绍 "),a("code",[s._v("lin-cms")]),s._v(" 的目录结构和代码规范，希望读者能够理解并且运用到自己的开发中。")]),s._v(" "),a("h2",{attrs:{id:"目录结构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#目录结构"}},[s._v("#")]),s._v(" 目录结构")]),s._v(" "),a("p",[s._v("以前每谈及 java，笔者的第一反应就是"),a("code",[s._v("麻烦")]),s._v("，这个麻烦集中在两个点上：一、臃肿啰嗦\n的代码；二、繁陈复杂的目录结构。")]),s._v(" "),a("p",[s._v("后来笔者分别使用"),a("code",[s._v("python")]),s._v("，"),a("code",[s._v("php")]),s._v("以及"),a("code",[s._v("node.js")]),s._v("等语言完成过实际项目，在开发，测试，\n维护，运维等诸多环节中兜兜转转，笔者忽然觉得"),a("code",[s._v("java")]),s._v("的"),a("code",[s._v("麻烦")]),s._v("实则是规范的精髓。")]),s._v(" "),a("p",[s._v("看似啰嗦的代码却恰巧代表了代码的严谨，复杂的目录结构也正好表明项目的工整。多层的\n组织降低了代码的耦合性，提高了复用性，给重构和维护带来了极大的方便。")]),s._v(" "),a("p",[a("code",[s._v("lin-cms-spring-boot")]),s._v("的目录结构参考了大量的 spring-boot 项目，严格遵守 MVC 的代码组织，\n不仅如此，为了让项目更加严谨，我们研读了阿里巴巴规约手册中的 java 内容，吸收了大量的既成规范。")]),s._v(" "),a("p",[s._v("项目目录结构如下：")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("├── bo bussiness object 业务类\n├── common 公共类库\n│   ├── aop aop相关\n│   ├── configuration 配置相关\n│   ├── constant 常量类\n│   ├── exception 异常处理\n│   ├── interceptor 拦截器\n│   ├── mybatis mybatis相关\n│   └── util 工具类\n├── controller 控制层\n│   ├── cms cms视图\n│   └── v1 api视图\n├── dto data access object\n│   ├── admin\n│   ├── book\n│   └── user\n├── extension 扩展\n│   ├── file 文件扩展\n├── mapper mybatis mapper\n├── model 数据模型\n├── service 业务层\n└── vo view object 视图类\n")])])]),a("p",[s._v("在每个目录的后面，我们都以注释的方式标明了其作用，当然还需要着重说明如下几点。")]),s._v(" "),a("ol",[a("li",[s._v("bo，vo，do，dto 究竟是什么？")])]),s._v(" "),a("p",[a("code",[s._v("o")]),s._v("是 object 的缩写，即对象的意思，主要用来封装某一层返回的数据结果， "),a("code",[s._v("b")]),s._v("表\n示"),a("code",[s._v("bussiness")]),s._v("，连起来就是业务对象类，用来封装业务层返回的结果；同理 "),a("code",[s._v("vo")]),s._v("全\n称"),a("code",[s._v("view object")]),s._v("，用来封装视图层的返回结果；"),a("code",[s._v("dto")]),s._v("全称"),a("code",[s._v("data transform object")]),s._v("，用\n来封装传输层的数据，如校验类。")]),s._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[s._v("mapper 和 service")])]),s._v(" "),a("p",[a("code",[s._v("mapper")]),s._v("的概念主要源于"),a("code",[s._v("mybatis")]),s._v("，存放 mapper 相关的接口；service 是业务接口及实\n现，每一个"),a("code",[s._v("service")]),s._v("最好都有其接口定义与具体实现，方便接口重写。")]),s._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[s._v("controller 和 model")])]),s._v(" "),a("p",[a("code",[s._v("controller")]),s._v("即视图层，"),a("code",[s._v("model")]),s._v("是模型层，里面的数据类与数据表一一对应，也就是阿里规范中的"),a("code",[s._v("do")]),s._v("。")]),s._v(" "),a("ol",{attrs:{start:"4"}},[a("li",[s._v("common")])]),s._v(" "),a("p",[s._v("公共类库，里面主要是与工程相关的基础类库，如"),a("code",[s._v("自动配置类")]),s._v("等。")]),s._v(" "),a("p",[s._v("关于"),a("code",[s._v("extension")]),s._v("将在后面的小节中介绍。")]),s._v(" "),a("p",[s._v("以上的目录可能并非你自己的项目的最终目录，它只是"),a("code",[s._v("lin-cms")]),s._v("在诸多实践中的讨论与沉淀，希望它能为你在项目规范与开发上帮上一把。")]),s._v(" "),a("h2",{attrs:{id:"规范"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#规范"}},[s._v("#")]),s._v(" 规范")]),s._v(" "),a("h3",{attrs:{id:"异常规范"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#异常规范"}},[s._v("#")]),s._v(" 异常规范")]),s._v(" "),a("p",[s._v("lin-cms 提供了基础的异常类，这些异常类继承自"),a("code",[s._v("HttpException")]),s._v("，当程序抛出这些异常时，默认的异常处理机制会将异常信息以规定的格式返回给前端。")]),s._v(" "),a("p",[s._v("lin-cms 的异常类中主要有三个属性——"),a("code",[s._v("message")]),s._v("，"),a("code",[s._v("httpCode")]),s._v("，"),a("code",[s._v("code")]),s._v("。")]),s._v(" "),a("p",[a("code",[s._v("message")]),s._v("是异常携带的信息，也是 java 异常中默认的信息字段，你可以通过构造函数的\n方式去改变它：")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('throw new HttpException("message");\n')])])]),a("p",[a("code",[s._v("httpCode")]),s._v("是返回给前端的 http status，表示当前请求的状态，我们推荐每一种 http\nstatus 都应该有一个相应的异常类，如"),a("code",[s._v("ForbiddenException")]),s._v("。")]),s._v(" "),a("p",[a("code",[s._v("code")]),s._v("表示消息码，如 "),a("code",[s._v("9999")]),s._v("消息码，每个消息码都有默认对应的英文消息，以及配置的中文消息；我们通过消息码这个媒介来处理中、英文消息的转换，从而实现国际化。")]),s._v(" "),a("p",[s._v("当前端请求触发了一个异常，异常被程序捕捉后，以如下相应结构返回：")]),s._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"code"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10051")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"message"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"令牌过期"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"request"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"POST /cms/admin/permission/remove"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("p",[s._v("相应中有刚才提到的"),a("code",[s._v("code")]),s._v("和"),a("code",[s._v("message")]),s._v("，以及前端请求的部分信息"),a("code",[s._v("request")]),s._v("。")]),s._v(" "),a("p",[s._v("可以看到，"),a("code",[s._v("10051")]),s._v("消息码携带了其对应的"),a("code",[s._v("message")]),s._v("，且 "),a("code",[s._v("message")]),s._v(" 是中文的，默认情况下\n"),a("code",[s._v("message")]),s._v("是英文的，如果你在相应的配置文件中进行了配置，消息则返回中文。")]),s._v(" "),a("p",[s._v("配置文件为"),a("code",[s._v("resources/code.properties")]),s._v("。")]),s._v(" "),a("h3",{attrs:{id:"操作成功规范"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#操作成功规范"}},[s._v("#")]),s._v(" 操作成功规范")]),s._v(" "),a("p",[s._v("如果你操作成功了，lin-cms 有两种情况下返回结果。")]),s._v(" "),a("ol",[a("li",[s._v("获取信息，比如获取用户信息，返回结果直接就是"),a("code",[s._v("json")]),s._v("格式下的用户信息。")]),s._v(" "),a("li",[s._v("操作信息，如过删除某个用户成功了，用户信息由于被删除了，不可能返回该用户信息\n了，但是仍需要告诉前端操作结果。这个结果的类似于：")])]),s._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"code"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"message"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"OK"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"request"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"POST /cms/admin/permission/remove"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("p",[s._v("这于异常信息的结构一致，因此为了区分异常和成功，我们规定"),a("code",[s._v("code")]),s._v("小于 10000 的作为成功的消息码，否则应该是失败消息码。")]),s._v(" "),a("h3",{attrs:{id:"接口规范"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#接口规范"}},[s._v("#")]),s._v(" 接口规范")]),s._v(" "),a("p",[s._v("lin-cms 遵守 restful 规范，即增（POST）删（DELETE）查（GET）改（PUT），请尽量按\n照该规范来定义你自己的接口。")]),s._v(" "),a("h3",{attrs:{id:"业务规范"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#业务规范"}},[s._v("#")]),s._v(" 业务规范")]),s._v(" "),a("p",[s._v("我们推荐你为每一个"),a("code",[s._v("Service")]),s._v("都定义一个接口以及接口实现，如"),a("code",[s._v("AdminService")]),s._v("和"),a("code",[s._v("AdminServiceImpl")]),s._v("。")]),s._v(" "),a("h3",{attrs:{id:"校验规范"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#校验规范"}},[s._v("#")]),s._v(" 校验规范")]),s._v(" "),a("p",[s._v("如果一个接口需要做参数校验，我们推荐使用 spring-boot-validation-starter，且为每一个需要校验的接口定一个校验类，类似于：")]),s._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Data")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("NewGroupDTO")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@NotBlank")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("message "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{group.name.not-blank}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Length")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("min "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" max "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" message "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{group.name.length}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Length")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("min "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" max "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("255")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" message "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{group.info.length}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" info"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@LongList")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("allowBlank "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" message "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{permission.ids.long-list}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Long")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" permissionIds"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("p",[s._v("考虑到校验信息的统一处理，我们通过占位符的方式来定义校验失败的信息，\n如"),a("code",[s._v("{group.name.not-blank}")]),s._v("。")]),s._v(" "),a("p",[s._v("你可以在 resources 目录下的"),a("code",[s._v("ValidationMessages.properties")]),s._v("配置该信息。")]),s._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),a("p",[s._v("规范是一件繁琐却又必要的事情，如果你有更好的规范推荐，欢迎一起完善！")])]),s._v(" "),a("RightMenu")],1)}),[],!1,null,null,null);t.default=n.exports}}]);