(window.webpackJsonp=window.webpackJsonp||[]).push([[171],{551:function(e,t,s){"use strict";s.r(t);var a=s(26),n=Object(a.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"令牌"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#令牌"}},[e._v("#")]),e._v(" "),s("H2Icon"),e._v(" 令牌")],1),e._v(" "),s("h2",{attrs:{id:"为何选择-jwt"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#为何选择-jwt"}},[e._v("#")]),e._v(" 为何选择 jwt?")]),e._v(" "),s("p",[e._v("最近几年 Restful API 及 SPA(单页面应用) 的盛行，cookie-session 的机制似乎越来越\n不适合前后端分离的场景。在分布式和微服务的趋势下，不少人选择在 redis 中存储\nsession 来达到单点登陆的效果，这无疑增加了成本和开发难度。于是更多的人转而使用\njwt 来管理用户会话和授权，在 jwt"),s("a",{attrs:{href:"https://jwt.io/introduction/",target:"_blank",rel:"noopener noreferrer"}},[e._v("官网"),s("OutboundLink")],1),e._v("介绍其两大使\n用场景。")]),e._v(" "),s("ul",[s("li",[s("p",[e._v("Authorization(授权)：这是 jwt 应用最为广泛的场景。jwt 将数据加密存储，分发给前\n端，前端将其放在特定的 header 字段 中（也有放在 params 和 body 中），服务器收\n到请求后，解析 jwt 判断用户身份，对用户请求进行限权。")])]),e._v(" "),s("li",[s("p",[e._v("Information Exchange(数据交换): jwt 可以通过公钥和私钥对信息进行加密，双方通信\n后，互得数据。")])])]),e._v(" "),s("p",[e._v("关于 jwt 的使用及生态请阅读 jwt"),s("a",{attrs:{href:"https://jwt.io/introduction/",target:"_blank",rel:"noopener noreferrer"}},[e._v("官网"),s("OutboundLink")],1),e._v("获得更多信息\n。")]),e._v(" "),s("h2",{attrs:{id:"access-token-和-refresh-token"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#access-token-和-refresh-token"}},[e._v("#")]),e._v(" access_token 和 refresh_token")]),e._v(" "),s("p",[e._v("在一般 jwt 应用中，"),s("em",[e._v("access_token")]),e._v("和"),s("em",[e._v("refresh_token")]),e._v("是一对相互帮助的好搭档，前面讲\n到用户在前端登陆后，服务器会发送 access_token 和 refresh_token 给前端，前端在得\n到这两个 token 之后必须"),s("strong",[e._v("谨慎存储")]),e._v("。")]),e._v(" "),s("ul",[s("li",[s("p",[e._v("access_token ：用来用户鉴权，控制用户对接口，资源的访问。access_token 十分重要\n，它是服务器对前端有力控制的唯一途径，故一般其生存周期十分短，一般在 2 个小时\n左右，更有甚者，其生命周期只有 15 分钟，在 Lin 中默认 1 个小时。")])]),e._v(" "),s("li",[s("p",[e._v("refresh_token ：用户通过登陆后获得 access_token，而 access_token 的生命周期十\n分短暂，但是用户登陆太频繁会严重影响体验，因此需要一种免登陆便能获取\naccess_token 的方式。refresh_token 主要用来解决该问题，refresh_token 的生命周\n期较长，一般为 30 天左右，但 refresh_token 不能被用来用户身份鉴权和获取资源，\n它只能被用来重新获取 access_token。当前端发现 access_token 过期时，便应通过\nrefresh_token 重新获取 access_token。")])])]),e._v(" "),s("h2",{attrs:{id:"项目中的使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#项目中的使用"}},[e._v("#")]),e._v(" 项目中的使用")]),e._v(" "),s("p",[e._v("在 Lin 中已经默认集成了 jwt 的机制，你可以通过 HTTP 请求来进行相关的操作。")]),e._v(" "),s("h3",{attrs:{id:"用户获取-access-token-和-refresh-token"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#用户获取-access-token-和-refresh-token"}},[e._v("#")]),e._v(" 用户获取 access_token 和 refresh_token")]),e._v(" "),s("p",[s("code",[e._v("path")]),e._v(": /cms/user/login")]),e._v(" "),s("p",[s("code",[e._v("method")]),e._v(": post")]),e._v(" "),s("p",[s("code",[e._v("参数")]),e._v(":")]),e._v(" "),s("table",[s("thead",[s("tr",[s("th",[e._v("name")]),e._v(" "),s("th",{staticStyle:{"text-align":"center"}},[e._v("说明")]),e._v(" "),s("th",{staticStyle:{"text-align":"center"}},[e._v("类型")]),e._v(" "),s("th",[e._v("作用")])])]),e._v(" "),s("tbody",[s("tr",[s("td",[e._v("username")]),e._v(" "),s("td",{staticStyle:{"text-align":"center"}},[e._v("用户名")]),e._v(" "),s("td",{staticStyle:{"text-align":"center"}},[e._v("string")]),e._v(" "),s("td",[e._v("****")])]),e._v(" "),s("tr",[s("td",[e._v("password")]),e._v(" "),s("td",{staticStyle:{"text-align":"center"}},[e._v("密码")]),e._v(" "),s("td",{staticStyle:{"text-align":"center"}},[e._v("string")]),e._v(" "),s("td",[e._v("****")])])])]),e._v(" "),s("p",[s("code",[e._v("结果")]),e._v(":")]),e._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[e._v('"access_token"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpYXQiOjE1MzU1MzMyNjMsIm5iZiI6MTUzNTUzMzI2MywianRpIjoiMTlkZWUwNzQtNzUxYi00MjBlLTk3NjAtZDRkMzc3YjdjMjUyIiwiZXhwIjoxNTM1NjE5NjYzLCJpZGVudGl0eSI6InBlZHJvIiwiZnJlc2giOmZhbHNlLCJ0eXBlIjoiYWNjZXNzIn0.9sNmAV5anxY5N1S1kaXzRRpdjzVX3fX6iI0ZjxGiiVs"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[e._v('"refresh_token"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpYXQiOjE1MzU1MzMyNjMsIm5iZiI6MTUzNTUzMzI2MywianRpIjoiYjU0OWIwZGEtMTE3MS00NzJlLWE0MDMtMDFkMGRkZTRjOTYzIiwiZXhwIjoxNTM4MTI1MjYzLCJpZGVudGl0eSI6InBlZHJvIiwidHlwZSI6InJlZnJlc2gifQ.cBnqEBnome-dMFEueQ8oCJfoXX9_mzQJAGjyeq4bYh8"')]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),s("p",[s("code",[e._v("使用")]),e._v(":")]),e._v(" "),s("p",[e._v("在请求其他资源或接口时在 header 中，加入"),s("code",[e._v("Authorization")]),e._v("字段，字段值为"),s("code",[e._v("Bearer")]),e._v("加\n上"),s("code",[e._v("access_token")]),e._v("，注意两个字段中间必须有一个空格，如下：")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpYXQiOjE1MzU1MzMyNjMsIm5iZiI6MTUzNTUzMzI2MywianRpIjoiMTlkZWUwNzQtNzUxYi00MjBlLTk3NjAtZDRkMzc3YjdjMjUyIiwiZXhwIjoxNTM1NjE5NjYzLCJpZGVudGl0eSI6InBlZHJvIiwiZnJlc2giOmZhbHNlLCJ0eXBlIjoiYWNjZXNzIn0.9sNmAV5anxY5N1S1kaXzRRpdjzVX3fX6iI0ZjxGiiVs\n")])])]),s("p",[e._v("服务器会解析该字段并得到用户信息，对用户进行鉴权。")]),e._v(" "),s("h3",{attrs:{id:"refresh-token-获取-access-token"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#refresh-token-获取-access-token"}},[e._v("#")]),e._v(" refresh_token 获取 access_token")]),e._v(" "),s("p",[s("code",[e._v("path")]),e._v(": /cms/user/refresh")]),e._v(" "),s("p",[s("code",[e._v("method")]),e._v(": get")]),e._v(" "),s("p",[s("code",[e._v("参数")]),e._v(": 无，注意在 Authorization 中加上 refresh_token。 "),s("code",[e._v("结果")]),e._v(":")]),e._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[e._v('"access_token"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpYXQiOjE1MzU1MzMyNjMsIm5iZiI6MTUzNTUzMzI2MywianRpIjoiMTlkZWUwNzQtNzUxYi00MjBlLTk3NjAtZDRkMzc3YjdjMjUyIiwiZXhwIjoxNTM1NjE5NjYzLCJpZGVudGl0eSI6InBlZHJvIiwiZnJlc2giOmZhbHNlLCJ0eXBlIjoiYWNjZXNzIn0.9sNmAV5anxY5N1S1kaXzRRpdjzVX3fX6iI0ZjxGiiVs"')]),e._v("\n")])])]),s("p",[s("code",[e._v("使用")]),e._v("：")]),e._v(" "),s("p",[e._v("用户获取资源时，"),s("code",[e._v("Authorization")]),e._v("字段的值为"),s("code",[e._v("Bearer")]),e._v("加上"),s("code",[e._v("access_token")]),e._v("，当通过\nrefresh_token 获取 access_token 时，应将"),s("code",[e._v("Authorization")]),e._v("中的 access_token 替换为\nrefresh_token，如：")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpYXQiOjE1MzU1MzMyNjMsIm5iZiI6MTUzNTUzMzI2MywianRpIjoiYjU0OWIwZGEtMTE3MS00NzJlLWE0MDMtMDFkMGRkZTRjOTYzIiwiZXhwIjoxNTM4MTI1MjYzLCJpZGVudGl0eSI6InBlZHJvIiwidHlwZSI6InJlZnJlc2gifQ.cBnqEBnome-dMFEueQ8oCJfoXX9_mzQJAGjyeq4bYh8\n")])])]),s("p",[e._v("服务器会解析该字段，如 refresh_token 字段未过期则会发送新的 access_token。")]),e._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),s("p",[e._v("当然在 Lin 的前端框架中，已经默认实现了以上机制，你大可不必自己去实现，当然如果\n你想深入了解，也可在阅读本小节后自行尝试。")])])])}),[],!1,null,null,null);t.default=n.exports}}]);