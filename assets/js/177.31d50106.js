(window.webpackJsonp=window.webpackJsonp||[]).push([[177],{558:function(t,a,s){"use strict";s.r(a);var n=s(26),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"文件上传"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#文件上传"}},[t._v("#")]),t._v(" 文件上传")]),t._v(" "),s("p",[t._v("lin-cms 默认集成了文件上传功能，并可自由切换存储位置，前端也有相应的组件匹配使用。")]),t._v(" "),s("h2",{attrs:{id:"使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用"}},[t._v("#")]),t._v(" 使用")]),t._v(" "),s("p",[t._v("lin-cms 默认对外暴露了"),s("code",[t._v("cms/file/")]),t._v("作为文件上传接口，通过该接口可以直接使用 HTTP\npost 方法上传文件。")]),t._v(" "),s("p",[t._v("文件默认会上传到本地，当前工作目录下的 assets 目录。")]),t._v(" "),s("h2",{attrs:{id:"实践"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#实践"}},[t._v("#")]),t._v(" 实践")]),t._v(" "),s("p",[t._v("文件上传是开箱即用的，使用 postman 测试一下文件上传：")]),t._v(" "),s("img-wrapper",[s("img",{attrs:{src:"http://imglf4.nosdn0.126.net/img/Qk5LWkJVWkF3NmlvOHFlZzFHSk95OGhiL0lSSFo3OFNPSGc1WEFnc0JRVERUb2JSU0cvSUlnPT0.png?imageView&thumbnail=2090y1120&type=png&quality=96&stripmeta=0"}})]),t._v(" "),s("p",[t._v("上传成功后，我们会得到如下的结果：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("[\n  {\n    key: 'one',\n    id: 13,\n    url:\n      'http://localhost:5000/assets/2019/05/19/3428c02f-dfb5-47a0-82cf-2d6c05285473.png'\n  },\n  {\n    key: 'two',\n    id: 14,\n    url:\n      'http://localhost:5000/assets/2019/05/19/bfcff6f4-8dd7-4dd8-af9d-660781d0e076.jpg'\n  }\n];\n")])])]),s("p",[t._v("由于上传了两个文件，因此我们得到了两个元素的数组，它们的结构如下：")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("name")]),t._v(" "),s("th",{staticStyle:{"text-align":"center"}},[t._v("说明")]),t._v(" "),s("th",{staticStyle:{"text-align":"center"}},[t._v("类型")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("key")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("文件上传的 key")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("string")])]),t._v(" "),s("tr",[s("td",[t._v("id")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("文件存储到数据库的 id")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("string")])]),t._v(" "),s("tr",[s("td",[t._v("url")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("可访问的 url")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("string")])])])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),s("p",[t._v("系统会自动帮助我们上传的文件做 md5，因此你大可不必担心文件重复上传，如果你上传了\n重复的文件，服务器会返回已传文件的数据。")])]),t._v(" "),s("h2",{attrs:{id:"配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置"}},[t._v("#")]),t._v(" 配置")]),t._v(" "),s("h3",{attrs:{id:"本地配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#本地配置"}},[t._v("#")]),t._v(" 本地配置")]),t._v(" "),s("p",[t._v("通过配置文件"),s("code",[t._v("src/main/java/io/github/talelin/latticy/extensions/file/config.properties")]),t._v("，\n可以改变文件上传的行为，配置项如下：")]),t._v(" "),s("div",{staticClass:"language-properties extra-class"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# upload")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 只能从max-file-size设置总体文件的大小")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 上传文件总大小")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("spring.servlet.multipart.max-file-size")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("20MB")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 每个文件的大小")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("lin.cms.file.single-limit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("2MB")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 上传文件总数量")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("lin.cms.file.nums")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("10")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 禁止某些类型文件上传，文件格式以,隔开")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("lin.cms.file.exclude")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 允许某些类型文件上传，文件格式以,隔开")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("lin.cms.file.include")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(".jpg,.png,.jpeg")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 文件上传后，访问域名配置")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("lin.cms.file.domain")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("http://localhost:5000/")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 文件存储位置，默认在工作目录下的assets目录")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("lin.cms.file.store-dir")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("assets/")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 具体实现")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("lin.cms.file.uploader")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("local")]),t._v("\n")])])]),s("p",[t._v("在每个配置的后面，我们均以注释的方式解释了每项的作用。")]),t._v(" "),s("p",[t._v("当然还需要着重解释一下"),s("code",[t._v("exclude")]),t._v("和"),s("code",[t._v("include")]),t._v("这两项配置，默认情况下，这两者只会有一\n项生效；若这二者中有一项为空，则另一项不为空的配置会生效；如果两项皆为空的话，会\n通过所有文件类型；如果二者都不为空，则"),s("code",[t._v("include")]),t._v("为有效配置，而"),s("code",[t._v("exclude")]),t._v("会失效；总\n而言之，系统只会支持使用一项，二者都为为空的情况下，则通过所有文件类型。")]),t._v(" "),s("h3",{attrs:{id:"远程配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#远程配置"}},[t._v("#")]),t._v(" 远程配置")]),t._v(" "),s("p",[t._v("将文件上传到本地显然不是一个很好的选择，lin-cms 额外提供了上传到云的支持，只需更改几个配置\n即可更换文件上传的存储位置。")]),t._v(" "),s("p",[t._v("目前，我们仅支持七牛云一种，后续会提供更多的选择。")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),s("p",[t._v("请确保你已经拥有七牛云的相关服务账号和配置信息。")])]),t._v(" "),s("p",[t._v("修改七牛相关配置，如下：")]),t._v(" "),s("div",{staticClass:"language-properties extra-class"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 七牛云域名")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("lin.cms.file.domain")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("{domain}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 七牛")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("lin.cms.file.qiniuyun.access-key")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("{******&}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("lin.cms.file.qiniuyun.secret-key")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("{&******}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("lin.cms.file.qiniuyun.bucket")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("{bucket}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 具体实现")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("lin.cms.file.uploader")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("qiniuyun")]),t._v("\n")])])]),s("p",[t._v("这里，我们增加了三个配置，分别是 access-key，secret-key 和 bucket，这三个配置\n你必须从你的七牛云账号获得，然后将其准确的填写入配置。")]),t._v(" "),s("p",[t._v("另外，我们还需要修改两个配置，一个是文件服务器域名（七牛云配置中的域名），另一个是\nuploader 的实现，将"),s("code",[t._v("LocalUploader")]),t._v("修改为"),s("code",[t._v("QiniuUploader")]),t._v("。")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// io.github.talelin.latticy.extension.file.UploaderConfiguration")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Configuration")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UploaderConfiguration")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n     * @return 本地文件上传实现类\n     */")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Bean")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Order")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@ConditionalOnMissingBean")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Uploader")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("uploader")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// return new LocalUploader();")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("QiniuUploader")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("配置修改完毕后，文件上传就可以无缝切换到云上了。")]),t._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),s("p",[t._v("一定要填写正确的 access-key，secret-key，bucket 以及 domain。")])]),t._v(" "),s("RightMenu")],1)}),[],!1,null,null,null);a.default=e.exports}}]);