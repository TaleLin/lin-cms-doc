(window.webpackJsonp=window.webpackJsonp||[]).push([[183],{563:function(e,t,s){"use strict";s.r(t);var a=s(26),n=Object(a.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"令牌"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#令牌"}},[e._v("#")]),e._v(" "),s("H2Icon"),e._v(" 令牌")],1),e._v(" "),s("h2",{attrs:{id:"为何选择-jwt"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#为何选择-jwt"}},[e._v("#")]),e._v(" 为何选择 jwt?")]),e._v(" "),s("p",[e._v("lin-cms 选择 jwt 作为用户认证鉴权的核心机制。与 cookie-session 的机制相比，jwt\n更加轻量和方便，节约了开发和运维成本。在jwt"),s("a",{attrs:{href:"https://jwt.io/introduction/",target:"_blank",rel:"noopener noreferrer"}},[e._v("官网"),s("OutboundLink")],1),e._v("介绍其两大使用场景。")]),e._v(" "),s("ul",[s("li",[s("p",[e._v("Authorization(授权)：这是 jwt 应用最为广泛的场景。jwt 将数据加密存储，分发给前\n端，前端将其放在特定的 header 字段 中（也有放在 params 和 body 中），服务器收\n到请求后，解析 jwt 判断用户身份，对用户请求进行限权。")])]),e._v(" "),s("li",[s("p",[e._v("Information Exchange(数据交换): jwt 可以通过公钥和私钥对信息进行加密，双方通信\n后，互得数据。")])])]),e._v(" "),s("p",[e._v("如果你想了解 jwt 更多的信息和生态请阅读jwt"),s("a",{attrs:{href:"https://jwt.io/introduction/",target:"_blank",rel:"noopener noreferrer"}},[e._v("官网"),s("OutboundLink")],1),e._v("。")]),e._v(" "),s("h2",{attrs:{id:"access-token-和-refresh-token"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#access-token-和-refresh-token"}},[e._v("#")]),e._v(" access_token 和 refresh_token")]),e._v(" "),s("p",[e._v("jwt 机制颇为灵活，如 Github 选择了单令牌机制，lin-cms 为了增强用户体验、提高接口\n安全性， lin-cms 选择了双令牌机制。在双令牌机制中，\n"),s("em",[e._v("access_token")]),e._v("和"),s("em",[e._v("refresh_token")]),e._v("是一对相互帮助的好搭档，用户登陆成功后，服务器\n会颁发 access_token 和 refresh_token，前端在得到这两个 token 之后必须"),s("strong",[e._v("谨慎存储")]),e._v("，它们的作用如下：")]),e._v(" "),s("ul",[s("li",[s("p",[e._v("access_token ：用户访问接口，资源的凭证。access_token 十分重要，它是服务器对前\n端有力控制的唯一途径，其生存周期较短，一般在 2 个小时左右，更有甚者，其生命周\n期只有 15 分钟，在 lin-cms 中默认为 1 个小时。")])]),e._v(" "),s("li",[s("p",[e._v("refresh_token ：用户重新获得 access_token 的凭证。refresh_token 的生命周期较长\n，一般为 30 天左右，但 refresh_token 不能被用来用户身份鉴权和获取资源，它只能\n被用来重新获取 access_token。当前端发现 access_token 过期时，会自动通过\nrefresh_token 重新获取 access_token。")])])]),e._v(" "),s("h2",{attrs:{id:"使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用"}},[e._v("#")]),e._v(" 使用")]),e._v(" "),s("p",[e._v("lin-cms 已经默认集成了 jwt 双令牌机制，你可以方便地通过 HTTP 请求来进行令牌的颁\n布和刷新操作。")]),e._v(" "),s("h3",{attrs:{id:"用户登录获取-access-token、refresh-token"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#用户登录获取-access-token、refresh-token"}},[e._v("#")]),e._v(" 用户登录获取 access_token、refresh_token")]),e._v(" "),s("p",[s("code",[e._v("path")]),e._v(": /cms/user/login")]),e._v(" "),s("p",[s("code",[e._v("method")]),e._v(": post")]),e._v(" "),s("p",[s("code",[e._v("参数")]),e._v(":")]),e._v(" "),s("table",[s("thead",[s("tr",[s("th",[e._v("name")]),e._v(" "),s("th",{staticStyle:{"text-align":"center"}},[e._v("说明")]),e._v(" "),s("th",{staticStyle:{"text-align":"center"}},[e._v("类型")]),e._v(" "),s("th",[e._v("作用")])])]),e._v(" "),s("tbody",[s("tr",[s("td",[e._v("username")]),e._v(" "),s("td",{staticStyle:{"text-align":"center"}},[e._v("用户名")]),e._v(" "),s("td",{staticStyle:{"text-align":"center"}},[e._v("string")]),e._v(" "),s("td",[e._v("****")])]),e._v(" "),s("tr",[s("td",[e._v("password")]),e._v(" "),s("td",{staticStyle:{"text-align":"center"}},[e._v("密码")]),e._v(" "),s("td",{staticStyle:{"text-align":"center"}},[e._v("string")]),e._v(" "),s("td",[e._v("****")])])])]),e._v(" "),s("p",[s("code",[e._v("结果")]),e._v(":")]),e._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[e._v('"access_token"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpYXQiOjE1MzU1MzMyNjMsIm5iZiI6MTUzNTUzMzI2MywianRpIjoiMTlkZWUwNzQtNzUxYi00MjBlLTk3NjAtZDRkMzc3YjdjMjUyIiwiZXhwIjoxNTM1NjE5NjYzLCJpZGVudGl0eSI6InBlZHJvIiwiZnJlc2giOmZhbHNlLCJ0eXBlIjoiYWNjZXNzIn0.9sNmAV5anxY5N1S1kaXzRRpdjzVX3fX6iI0ZjxGiiVs"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[e._v('"refresh_token"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpYXQiOjE1MzU1MzMyNjMsIm5iZiI6MTUzNTUzMzI2MywianRpIjoiYjU0OWIwZGEtMTE3MS00NzJlLWE0MDMtMDFkMGRkZTRjOTYzIiwiZXhwIjoxNTM4MTI1MjYzLCJpZGVudGl0eSI6InBlZHJvIiwidHlwZSI6InJlZnJlc2gifQ.cBnqEBnome-dMFEueQ8oCJfoXX9_mzQJAGjyeq4bYh8"')]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),s("p",[s("code",[e._v("使用")]),e._v(":")]),e._v(" "),s("p",[e._v("在得到令牌后，在 HTTP 请求的 Header 中加入"),s("code",[e._v("Authorization")]),e._v("字段，字段值\n为"),s("code",[e._v("Bearer")]),e._v("加上"),s("code",[e._v("access_token")]),e._v("，注意两个字段中间必须有一个空格，如下：")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpYXQiOjE1MzU1MzMyNjMsIm5iZiI6MTUzNTUzMzI2MywianRpIjoiMTlkZWUwNzQtNzUxYi00MjBlLTk3NjAtZDRkMzc3YjdjMjUyIiwiZXhwIjoxNTM1NjE5NjYzLCJpZGVudGl0eSI6InBlZHJvIiwiZnJlc2giOmZhbHNlLCJ0eXBlIjoiYWNjZXNzIn0.9sNmAV5anxY5N1S1kaXzRRpdjzVX3fX6iI0ZjxGiiVs\n")])])]),s("p",[e._v("服务器会解析该字段并得到用户信息，对用户进行鉴权。")]),e._v(" "),s("h3",{attrs:{id:"通过-refresh-token-获取-access-token"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#通过-refresh-token-获取-access-token"}},[e._v("#")]),e._v(" 通过 refresh_token 获取 access_token")]),e._v(" "),s("p",[s("code",[e._v("path")]),e._v(": /cms/user/refresh")]),e._v(" "),s("p",[s("code",[e._v("method")]),e._v(": get")]),e._v(" "),s("p",[s("code",[e._v("参数")]),e._v(": 无")]),e._v(" "),s("p",[s("code",[e._v("注意")]),e._v(": 必须在 HTTP 的 Header 中加上"),s("code",[e._v("Authorization")]),e._v("字段，字段值为\n"),s("code",[e._v("Bearer ${refresh_token}")]),e._v("。")]),e._v(" "),s("p",[s("code",[e._v("结果")]),e._v(":")]),e._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[e._v('"access_token"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpZGVudGl0eSI6MSwic2NvcGUiOiJsaW4iLCJ0eXBlIjoiYWNjZXNzIiwiZXhwIjoxNTc4OTI1NjU3fQ.SkyztGH0P7pH1kvxK60nkU8IGkVXF7YTNd706cW0sXw"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[e._v('"refresh_token"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpZGVudGl0eSI6MSwic2NvcGUiOiJsaW4iLCJ0eXBlIjoicmVmcmVzaCIsImV4cCI6MTU4MTUxNDA1N30.RmmAq_irja2TCM3tmpUEuJGDLWDWbPf9K0FRc8FklEY"')]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),s("p",[s("code",[e._v("使用")]),e._v("：")]),e._v(" "),s("p",[e._v("用户访问接口、资源时，必须在 HTTP Header 中附带"),s("code",[e._v("Authorization")]),e._v("字段，字段值\n为"),s("code",[e._v("Bearer ${access_token}")]),e._v("，当通过 refresh_token 获取 access_token 时，应\n将"),s("code",[e._v("Authorization")]),e._v("字段的值替换为"),s("code",[e._v("Bearer ${refresh_token}")]),e._v("。如：")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpYXQiOjE1MzU1MzMyNjMsIm5iZiI6MTUzNTUzMzI2MywianRpIjoiYjU0OWIwZGEtMTE3MS00NzJlLWE0MDMtMDFkMGRkZTRjOTYzIiwiZXhwIjoxNTM4MTI1MjYzLCJpZGVudGl0eSI6InBlZHJvIiwidHlwZSI6InJlZnJlc2gifQ.cBnqEBnome-dMFEueQ8oCJfoXX9_mzQJAGjyeq4bYh8\n")])])]),s("p",[e._v("服务器会自动解析"),s("code",[e._v("Authorization")]),e._v("字段，如 refresh_token 未过期则会颁发新的\naccess_token。")]),e._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),s("p",[e._v("在 lin-cms 的前端框架中，已经默认实现了以上机制，你大可不必自己去实现，当然如果\n你想深入了解，也可在阅读本小节后自行尝试。")])]),e._v(" "),s("RightMenu")],1)}),[],!1,null,null,null);t.default=n.exports}}]);